--echo #
--echo # Test for ANALYZE FAST ... PERSISTENT FOR COLUMNS (...) 
--echo #

DROP TABLE IF EXISTS Table1;

CREATE TABLE Table1 (
 PetName varchar(20),
 LastName varchar(20),
 FirstName varchar(20),
 PetAge int unsigned, 
 NumberOfPuppies int unsigned
);

INSERT INTO Table1 VALUES
("Flufy",   "Yates",     "Maria",   4, 12),
("Buttons", "David",     "Jones",   5, 10),
("Paws",    "Johanson",  "Samuel",  9, 20),
("Gina",    "Marry",     "Carl",    4 ,51),
("Rusa",    "June",      "Rick",    2 ,23),
("Alpha",   "July",      "Marty",   3 ,23),
("Bravo",   "August",    "Michael", 6 ,24),
("Charlie", "September", "John",    5 ,52),
("Delta",   "October",   "Sam",     6 ,62),
("Hector",  "November",  "Andrew",  5 ,12);

SELECT * FROM Table1;


set histogram_size=5;
set histogram_type='SINGLE_PREC_HB';
ANALYZE FAST TABLE Table1 PERSISTENT FOR COLUMNS (PetAge, NumberOfPuppies);
select *, hex(histogram), decode_histogram(hist_type, histogram)
from mysql.column_stats where table_name='Table1';

set histogram_size=10;
set histogram_type='DOUBLE_PREC_HB';
ANALYZE FAST TABLE Table1 PERSISTENT FOR COLUMNS (PetAge, NumberOfPuppies);
select *, hex(histogram), decode_histogram(hist_type, histogram)
from mysql.column_stats where table_name='Table1';

--error ER_POSITIVE_NUMBER
ANALYZE FAST TABLE Table1 WITH 0 ROWS PERSISTENT FOR COLUMNS (LastName);

--error ER_POSITIVE_NUMBER
ANALYZE FAST TABLE Table1 SAMPLING 0 PERCENT PERSISTENT FOR COLUMNS (LastName);

--error ER_POSITIVE_NUMBER
ANALYZE FAST TABLE Table1 LASTS 0 SECONDS PERSISTENT FOR COLUMNS (LastName);

--error ER_POSITIVE_NUMBER
ANALYZE FAST TABLE Table1 PERSISTENT FOR COLUMNS (LastName IN RANGE 0);

DROP TABLE Table1;
